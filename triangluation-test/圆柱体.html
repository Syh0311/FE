<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        overflow: hidden;
        font-family: Verdana;
      }
      canvas {
        width: 100%;
        height: 100%;
        display: block;
      }

      #info {
        position: absolute;
        margin-left: 10px;
      }

      a {
        color: yellow;
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <script src="./yjztcood.js"></script>
    <script src="https://threejs.org/build/three.min.js"></script>
    <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>

    <!-- https://github.com/mapbox/delaunator -->
    <!-- <script src="https://unpkg.com/delaunator@3.0.2/delaunator.js"></script> -->

    <script src="https://josephg.github.io/noisejs/perlin.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.3/dat.gui.min.js"></script>
    <script src="./delaunator.js"></script>

    <script type="application/json"></script>
    <script type="module">
      import { drawPaths, findDoundaryDepth, mockBoundary, addLayer, addBoundaryMesh } from "./tools.js";

      // ——————————————————————————————————————————————————
      // 初始化
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(60, 1, 1, 10000);
      camera.position.setScalar(150);
      const renderer = new THREE.WebGLRenderer({
        antialias: true,
      });
      const canvas = renderer.domElement;
      document.body.appendChild(canvas);
      const controls = new THREE.OrbitControls(camera, canvas);
      const light = new THREE.DirectionalLight(0xffffff, 1.5);
      light.position.setScalar(100);
      scene.add(light);
      scene.add(new THREE.AmbientLight(0xffffff, 0.5));

      const gridHelper = new THREE.GridHelper(800, 25);
      scene.add(gridHelper);

      // —————————————————————————————————————————————
      const holeData = [
        {
          name: "NAME",
          coord: [null, null],
          MATERTIAL: {
            NaN: [[0, null]],
          },
        },
        {
          name: "1-1",
          coord: [11908999.31, 3483257.183],
          MATERTIAL: {
            1: [[281.8, 283.2]],
            2: [[260.4, 281.8]],
          },
        },
        {
          name: "1-2",
          coord: [11909106.85, 3483181.336],
          MATERTIAL: {
            1: [[273.9, 284.7]],
            2: [[270.54, 271.5]],
            3: [[271.5, 273.9]],
            4: [[267.6, 270.54]],
          },
        },
        {
          name: "4-1",
          coord: [11921341.19, 3486008.635],
          MATERTIAL: {
            1: [[281.3, 281.8]],
            2: [
              [277.7, 278.7],
              [259.6, 262.3],
            ],
            3: [
              [278.7, 281.3],
              [262.3, 277.7],
            ],
          },
        },
        {
          name: "5-1",
          coord: [11909040.39, 3482858.703],
          MATERTIAL: {
            1: [[277.4, 281.3]],
            2: [[256.8, 277.4]],
          },
        },
        {
          name: "6-1",
          coord: [11909777.43, 3482025.722],
          MATERTIAL: {
            1: [[275.5, 284.5]],
            2: [[264.2, 275.5]],
          },
        },
        {
          name: "7-2",
          coord: [11909428.45, 3482016.867],
          MATERTIAL: {
            1: [[278.8, 282.3]],
            2: [[273, 278.8]],
            3: [[262.7, 273]],
          },
        },
        {
          name: "11-1",
          coord: [11908139.03, 3480148.215],
          MATERTIAL: {
            1: [[300.5, 301.5]],
            2: [
              [290.5, 296.5],
              [280.34, 289.8],
            ],
            3: [
              [296.5, 297.7],
              [289.8, 290.5],
            ],
            4: [[297.7, 300.5]],
          },
        },
        {
          name: "11-2",
          coord: [11909183.77, 3478900.502],
          MATERTIAL: {
            1: [[307.1, 310.4]],
            2: [[282.9, 307.1]],
          },
        },
        {
          name: "15-1",
          coord: [11911557.43, 3476291.539],
          MATERTIAL: {
            1: [[249.9, 260.7]],
            2: [[232.3, 249.9]],
          },
        },
        {
          name: "16-1",
          coord: [11911078.54, 3478061.62],
          MATERTIAL: {
            1: [[281.3, 282]],
            2: [[257.5, 281.3]],
          },
        },
        {
          name: "18-2",
          coord: [11909280.17, 3478218.257],
          MATERTIAL: {
            1: [[323.94, 326.54]],
            2: [[311.74, 323.94]],
            3: [[303.54, 311.74]],
          },
        },
        {
          name: "19-2",
          coord: [11909220.61, 3478852.136],
          MATERTIAL: {
            2: [[252.4, 273.8]],
          },
        },
        {
          name: "20-3",
          coord: [11910319.67, 3479689.147],
          MATERTIAL: {
            1: [[254.4, 258.6]],
            3: [[250.3, 254.4]],
          },
        },
        {
          name: "25-1",
          coord: [11911325.55, 3479668.489],
          MATERTIAL: {
            1: [[251.1, 258.6]],
            2: [
              [250, 251.1],
              [227.3, 245.3],
            ],
            3: [[245.3, 250]],
          },
        },
        {
          name: "30-1",
          coord: [11911219.8, 3478697.031],
          MATERTIAL: {
            1: [[275.8, 276.5]],
            2: [
              [269.2, 275.8],
              [263.5, 267.8],
              [249.9, 260.4],
            ],
            3: [
              [267.8, 269.2],
              [260.4, 263.5],
            ],
          },
        },
        {
          name: "36-1",
          coord: [11912920.43, 3476647.999],
          MATERTIAL: {
            1: [[215.8, 217]],
            2: [[195, 213.4]],
            3: [
              [213.4, 215.8],
              [191.1, 195],
            ],
          },
        },
        {
          name: "37-1",
          coord: [11911233.83, 3477547.593],
          MATERTIAL: {
            1: [[267, 268]],
            2: [[257.8, 267]],
            3: [[244.4, 257.8]],
          },
        },
        {
          name: "45-1",
          coord: [11911630.83, 3437551.109],
          MATERTIAL: {
            1: [[248, 267.8]],
            2: [[235.7, 248]],
          },
        },
        {
          name: "48-1",
          coord: [11912282.23, 3483483.443],
          MATERTIAL: {
            1: [[258.6, 261.5]],
            2: [[238.4, 258.6]],
          },
        },
        {
          name: "A-2",
          coord: [11907754.43, 3476846.948],
          MATERTIAL: {
            1: [[225.9, 228]],
            2: [
              [212.5, 224.3],
              [204.6, 211],
              [200.7, 203.5],
            ],
            3: [
              [211, 212.5],
              [203.5, 204.6],
              [188.7, 200.7],
            ],
            4: [[224.3, 225.9]],
          },
        },
        {
          name: "A-5",
          coord: [11914014.37, 3480074.439],
          MATERTIAL: {
            1: [[208.5, 209]],
            2: [[179, 208.5]],
          },
        },
        {
          name: "A-6",
          coord: [11909379.24, 3482920.688],
          MATERTIAL: {
            1: [[217.5, 218]],
            2: [[175, 217.5]],
          },
        },
        {
          name: "A-7",
          coord: [11909426.44, 3482131.847],
          MATERTIAL: {
            1: [[294.2, 296]],
            2: [[275.9, 294.2]],
          },
        },
        {
          name: "A-8",
          coord: [11910590.85, 3483700.338],
          MATERTIAL: {
            1: [[256.8, 266]],
            2: [
              [253.7, 256.8],
              [241.5, 249.6],
            ],
            3: [[249.6, 253.7]],
          },
        },
        {
          name: "A-9",
          coord: [11911447.23, 3481719.8],
          MATERTIAL: {
            1: [[258, 261]],
            2: [[241.8, 245.6]],
            3: [
              [250.2, 252.8],
              [236.5, 241.8],
            ],
            4: [[252.8, 258]],
            6: [[245.6, 250.2]],
          },
        },
        {
          name: "A-10",
          coord: [11909639.62, 3480056.733],
          MATERTIAL: {
            1: [[275.4, 278]],
            3: [[243.2, 275.4]],
          },
        },
        {
          name: "B-9",
          coord: [11916908.78, 3480457.564],
          MATERTIAL: {
            1: [[182.5, 185]],
            2: [[146, 182.5]],
          },
        },
        {
          name: "B-10",
          coord: [11911488.86, 3480316.168],
          MATERTIAL: {
            1: [[228.8, 229]],
            2: [[187, 228.8]],
          },
        },
        {
          name: "ZK04",
          coord: [11909985, 3476393],
          MATERTIAL: {
            1: [[282.12, 283.25]],
            2: [
              [262.83, 279.38],
              [253.9, 255.7],
            ],
            3: [
              [255.7, 262.83],
              [251.9, 253.9],
            ],
            4: [[279.38, 282.12]],
          },
        },
        {
          name: "ZK14",
          coord: [11907873, 3482083],
          MATERTIAL: {
            1: [[287.1, 256.26]],
            2: [
              [276.22, 287.1],
              [258.24, 259.84],
            ],
            3: [
              [259.84, 276.22],
              [255.45, 258.24],
            ],
          },
        },
        {
          name: "Y-J05",
          coord: [11909036, 3484324],
          MATERTIAL: {
            1: [[303.6, 306.28]],
            2: [
              [293.02, 303.6],
              [276.57, 287.75],
            ],
            3: [[287.75, 293.02]],
          },
        },
        {
          name: "ZK05",
          coord: [11911680, 3485629],
          MATERTIAL: {
            2: [[230.06, 257.42]],
            4: [[257.42, 260.78]],
          },
        },
        {
          name: "ZK08",
          coord: [11910612, 3474971],
          MATERTIAL: {
            2: [
              [210.42, 195.11],
              [186.94, 202.31],
            ],
            3: [[202.31, 210.42]],
          },
        },
      ];
      const center = [11921341.19, 3486008.635];
      const groundBase = 260;
      const colors = ["red", "gray", "blue", "pink", "white", "purple", "purple", "purple"];

      holeData.forEach((el) => {
        const group = new THREE.Group();
        const { name, coord, MATERTIAL } = el;

        // 两个for循环
        Object.keys(MATERTIAL).forEach((key) => {
          const chunks = caclPositionHeight(key, MATERTIAL[key]);
          chunks.forEach((chunk) => group.add(chunk));
        });

        group.position.x = (coord[0] - center[0]) / 30;
        group.position.z = (coord[1] - center[1]) / 30;
        scene.add(group);
      });

      //  测试输入
      function caclPositionHeight(key, depths) {
        const chunks = [];
        depths.forEach((range) => {
          const diff = range[1] - range[0];

          const geom = new THREE.CylinderGeometry(1, 1, diff, 32);
          const material = new THREE.MeshBasicMaterial({ color: colors[key], wireframe: false });
          const mesh = new THREE.Mesh(geom, material);

          const positionY = -(range[0] + diff / 2 - groundBase);

          mesh.position.y = positionY;
          chunks.push(mesh);
        });
        return chunks;
      }

      // ——————————————————————————————————————————
      // 渲染函数
      render();
      function resize(renderer) {
        const canvas = renderer.domElement;
        const width = canvas.clientWidth;
        const height = canvas.clientHeight;
        const needResize = canvas.width !== width || canvas.height !== height;
        if (needResize) {
          renderer.setSize(width, height, false);
        }
        return needResize;
      }
      function render() {
        if (resize(renderer)) {
          camera.aspect = canvas.clientWidth / canvas.clientHeight;
          camera.updateProjectionMatrix();
        }
        renderer.render(scene, camera);
        requestAnimationFrame(render);
      }
      // ——————————————————————————————————————————————————————————
      const settings = {
        cylinder1移动: 15,
        cylinder2移动: 20,
        "cylinder2-wireframe": 0,
        还原: 0,
      };

      const gui = new dat.GUI();
      gui
        .add(settings, "cylinder1移动", 0, 100, 0.5)
        .listen()
        .onChange(function (z) {
          cylinder1.position.y = z;
        });
      gui
        .add(settings, "cylinder2移动", 0, 100, 0.5)
        .listen()
        .onChange(function (z) {
          cylinder2.position.y = z;
        });
    </script>
  </body>
</html>
